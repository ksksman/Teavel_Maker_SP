<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.edu.springboot.restboard.IBoardService">
	<select id="list"
		parameterType="com.edu.springboot.restboard.ParameterDTO"
		resultType="com.edu.springboot.restboard.BoardDTO">
		SELECT * FROM (
			SELECT Tb.*, rownum rNum FROM (
				SELECT * FROM boards 
				WHERE board_cate = #{board_cate}
				ORDER BY board_idx DESC
				) Tb
			)
			WHERE rNum BETWEEN #{start} AND #{end}	
	</select>
	<select id="search"
		parameterType="com.edu.springboot.restboard.ParameterDTO"
		resultType="com.edu.springboot.restboard.BoardDTO">
		SELECT * FROM boards
		<if test="searchWord!=null">
			WHERE
			<foreach collection="searchWord" item="str"
				open="(" close=")" separator="or">
				${searchField} like '%' || #{str} || '%'
			</foreach>
		</if>	
		ORDER BY board_idx DESC
	</select>
	<select id="view"
		parameterType="com.edu.springboot.restboard.ParameterDTO"
		resultType="com.edu.springboot.restboard.BoardDTO">
		SELECT * FROM boards WHERE board_idx=#{board_idx}
	</select>
	<insert id="write"
		parameterType="com.edu.springboot.restboard.ParameterDTO">
		INSERT INTO board
			(num, title, content, id, visitcount)
		VALUES
			(seq_board_num.nextval, #{title}, #{content}, #{id}, 0)
	</insert>
	
	<!-- 좋아요 증가 -->
	<update id="increaseLikeCount" 
		parameterType="com.edu.springboot.restboard.ParameterDTO">
        UPDATE boards SET like_count = like_count + 1 WHERE board_idx = #{board_idx}
    </update>

	<!-- 조회수 증가 -->
    <update id="increaseViewCount"  
		parameterType="com.edu.springboot.restboard.ParameterDTO">
        UPDATE boards SET view_count = view_count + 1 WHERE board_idx = #{board_idx}
    </update>
	<!-- 리뷰 게시물 수정 -->
    <update id="updateBoard" parameterType="com.edu.springboot.restboard.BoardDTO">
        UPDATE boards SET 
            title = #{title},
            content = #{content}
        WHERE board_idx = #{board_idx}
    </update>

    <delete id="deleteBoard" parameterType="String">
        DELETE FROM boards WHERE board_idx = #{board_idx}
    </delete>
</mapper>




























